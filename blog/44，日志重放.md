> 在写数据的过程中需要记录写数据操作日志，一旦发生故障会丢失掉内存中的所有数据，当下一次启动的时候，通过复现已经记录的数据写操作日志，可以恢复到故障之前的状态

操作流程

- 写操作
  1. 更新操作依次记录到磁盘日志文件
  2. 更新内存数据
  3. 返回更新成功结果

- 恢复操作

  1，读取日志文件，依次修改内存中的数据

> 这里存在一个问题，如果内存中修改数据的操作非常巨大但key很少，很能可能记录了大量的操作但是最后可能只有一条记录。可以使用设置检查点解决



操作流程

- 记录操作
  1. 日志文件记录设置开始检查点
  2. 在某个时刻，把内存中的数据直接dump到磁盘中
  3. 日志文件记录结束检查点

- 恢复操作
  1. 扫描日志文件，找到最后的结束检查点对应的开始检查点
  2. 读入dump文件
  3. 一次回放日志记录

> 做dump操作的时候往往不能停止数据库的服务，需要防止记录了后面的操作。可以解决的一个办法是不要动正在使用的内存存储，而是对每10000条日志操作做一次dump操作，循序渐进。但是这样存在一个问题，就是可能会浪费内存，造成内存溢出





总之先实现一个比较简单的可以写和回复的日志记录系统吧



首先是写文件，每行都有一个版本号

然后是读文件，版本号处读取文件



































